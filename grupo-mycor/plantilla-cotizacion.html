<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotización Dinámica - TechBridge Consulting Systems</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Base styles */
        * {
            box-sizing: border-box; /* Ensures padding and border are included in the element's total width and height */
        }
        body {
            font-family: 'Inter', sans-serif;
            color: #1A202C; /* Tailwind's gray-900 */
            background-color: #f8fafc; /* Light blue-gray for background */
            line-height: 1.6;
        }
        .tbcs-blue { color: #0077C9; }
        .tbcs-blue-bg { background-color: #0077C9; }
        .tbcs-blue-border { border-color: #0077C9; }
        .container-padding { padding-left: 1.5rem; padding-right: 1.5rem; } /* px-6 */

        /* Estilos para la tabla de cotización */
        .quote-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 0.5rem;
            overflow: hidden; /* Ensures rounded corners apply to content */
        }
        .quote-table th, .quote-table td {
            padding: 1rem 1.25rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0; /* Tailwind gray-200 */
        }
        .quote-table th {
            background-color: #0077C9;
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.875rem; /* text-sm */
        }
        .quote-table tbody tr:nth-child(odd) {
            background-color: #fdfdfe; /* Slightly off-white for odd rows */
        }
        .quote-table tbody tr:nth-child(even) {
            background-color: #ffffff; /* White for even rows */
        }
        .quote-table tbody tr:last-child td {
            border-bottom: none;
        }
        .quote-table .module-header {
            background-color: #e0f2fe; /* Tailwind blue-50 for module headers */
            color: #0077C9;
            font-weight: 700;
            padding: 0.75rem 1.25rem;
            border-bottom: 1px solid #bfdbfe; /* Tailwind blue-200 */
        }
        .quote-table .total-row {
            background-color: #f0f9ff; /* Tailwind blue-50 for total row */
            font-weight: 700;
            font-size: 1.125rem; /* text-lg */
            border-top: 2px solid #0077C9;
        }
        .quote-table .total-row td:last-child {
            text-align: right;
            color: #0077C9;
        }

        /* Responsive table for small screens */
        @media (max-width: 768px) {
            .quote-table, .quote-table tbody, .quote-table tr, .quote-table td, .quote-table th {
                display: block;
                width: 100%;
            }
            .quote-table thead {
                display: none; /* Hide table header on small screens */
            }
            .quote-table tr {
                margin-bottom: 1rem;
                border: 1px solid #e2e8f0;
                border-radius: 0.5rem;
                overflow: hidden;
            }
            .quote-table td {
                text-align: right;
                position: relative;
                padding-left: 50%; /* Space for the pseudo-element label */
            }
            .quote-table td::before {
                content: attr(data-label);
                position: absolute;
                left: 0;
                width: 45%;
                padding-left: 1.25rem;
                font-weight: 600;
                text-align: left;
                color: #4a5568; /* Tailwind gray-700 */
            }
            .quote-table .module-header {
                text-align: center;
                padding-left: 1.25rem; /* Reset padding for module header */
            }
            .quote-table .module-header::before {
                content: none; /* Hide pseudo-element for module headers */
            }
            .quote-table .total-row {
                text-align: right;
                padding-left: 1.25rem; /* Reset padding for total row */
            }
            .quote-table .total-row td:first-child::before {
                content: none; /* Hide pseudo-element for the first cell of total row */
            }
            .quote-table .total-row td:last-child::before {
                content: 'Total Desarrollo:'; /* Custom label for total on mobile */
                width: auto;
                left: 1.25rem;
                font-size: 1rem;
                color: #0077C9;
            }
        }

        /* Modal specific styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            overflow-y: auto; /* Allow scrolling for modal content if it's too tall */
            padding: 1rem; /* Padding around the modal content */
        }
        .modal-content {
            background-color: #fff;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            position: relative;
            max-width: 90%; /* Max width for responsiveness */
            width: 800px; /* Fixed width for larger screens */
            margin: auto; /* Center content vertically if overflow-y: auto is active */
        }
        .modal-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #4a5568; /* Tailwind gray-700 */
        }
        .hidden {
            display: none !important;
        }

        /* Print-specific styles */
        @media print {
            #quoteFormSection, .print-hidden, .modal-overlay, #openQuoteFormBtn {
                display: none !important; /* Hide form, modal, and open button when printing */
            }
            body {
                background-color: #fff !important;
                margin: 0;
                padding: 0;
                -webkit-print-color-adjust: exact; /* For WebKit browsers to print background colors */
                print-color-adjust: exact; /* Standard property */
            }
            .max-w-6xl {
                max-width: 100% !important;
                margin: 0.5in auto !important; /* Add some margin for printing */
                padding: 0.5in !important; /* Add padding to the main content area */
                box-shadow: none !important;
                border-radius: 0 !important;
            }
            .quote-table {
                box-shadow: none !important;
                border: 1px solid #e2e8f0;
                page-break-inside: auto; /* Allow table to break across pages if necessary */
            }
            .quote-table th, .quote-table td {
                padding: 0.75rem 1rem;
                border-bottom: 1px solid #e2e8f0; /* Ensure borders are visible */
            }

            /* Override responsive table styles for print */
            .quote-table, .quote-table tbody, .quote-table tr, .quote-table td, .quote-table th {
                display: table !important;
                width: 100% !important;
            }
            .quote-table thead {
                display: table-header-group !important; /* Show table header on print */
            }
            .quote-table tr {
                margin-bottom: 0 !important; /* Remove margin between rows */
                border: none !important; /* Remove individual row borders */
            }
            .quote-table td {
                text-align: left !important; /* Reset text alignment */
                position: static !important; /* Reset position */
                padding-left: 1rem !important; /* Reset padding */
            }
            .quote-table td::before {
                content: none !important; /* Hide pseudo-element labels on print */
            }
            .quote-table .module-header,
            .quote-table .total-row {
                text-align: left !important; /* Ensure module headers and total row align left */
                padding-left: 1rem !important;
            }
            .quote-table .total-row td:last-child {
                text-align: right !important; /* Keep total cost aligned right */
            }
            .quote-table .total-row td:last-child::before {
                content: none !important; /* Hide pseudo-element for total on print */
            }

            /* Ensure content doesn't break inside important sections */
            section {
                page-break-inside: avoid;
            }
            header, footer {
                page-break-after: avoid;
            }
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="max-w-6xl mx-auto my-8 p-8 bg-white rounded-lg shadow-xl">
        <!-- Botón para abrir el formulario de cotización -->
        <div id="initialCallToAction" class="flex justify-center items-center h-64">
            <button id="openQuoteFormBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-lg text-xl focus:outline-none focus:shadow-outline transition duration-200">
                Crear Nueva Cotización
            </button>
        </div>

        <!-- Modal para el Formulario de Cotización -->
        <div id="quoteModal" class="modal-overlay hidden">
            <div class="modal-content">
                <button id="closeModalBtn" class="modal-close-btn">&times;</button>
                <section id="quoteFormSection" class="p-6 bg-blue-50 rounded-lg shadow-md">
                    <h2 class="text-2xl font-bold tbcs-blue mb-6 text-center">Generar Nueva Cotización</h2>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div>
                            <h3 class="font-bold text-xl mb-3">Información del Cliente:</h3>
                            <div class="mb-4">
                                <label for="clientName" class="block text-gray-700 text-sm font-bold mb-2">Nombre del Cliente:</label>
                                <input type="text" id="clientName" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" value="Michelle Rodríguez">
                            </div>
                            <div class="mb-4">
                                <label for="clientCompany" class="block text-gray-700 text-sm font-bold mb-2">Empresa:</label>
                                <input type="text" id="clientCompany" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" value="Grupo Mycor">
                            </div>
                            <div class="mb-4">
                                <label for="clientEmail" class="block text-gray-700 text-sm font-bold mb-2">Email:</label>
                                <input type="email" id="clientEmail" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" value="rtmps@hotmail.com">
                            </div>
                            <div class="mb-4">
                                <label for="clientPhone" class="block text-gray-700 text-sm font-bold mb-2">Celular:</label>
                                <input type="tel" id="clientPhone" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" value="55 2900 5393">
                            </div>
                        </div>
                        <div>
                            <h3 class="font-bold text-xl mb-3">Detalles de la Cotización:</h3>
                            <div class="mb-4">
                                <label for="quoteNumber" class="block text-gray-700 text-sm font-bold mb-2">Número de Cotización:</label>
                                <input type="text" id="quoteNumber" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" value="Q-TBCS-2025-001">
                            </div>
                            <div class="mb-4">
                                <label for="quoteDate" class="block text-gray-700 text-sm font-bold mb-2">Fecha:</label>
                                <input type="date" id="quoteDate" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                            </div>
                            <div class="mb-4">
                                <label for="quoteValidity" class="block text-gray-700 text-sm font-bold mb-2">Validez:</label>
                                <input type="text" id="quoteValidity" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" value="30 días">
                            </div>
                            <div class="mb-4">
                                <label for="hourlyRateInput" class="block text-gray-700 text-sm font-bold mb-2">Tarifa por hora (USD):</label>
                                <input type="number" id="hourlyRateInput" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" value="20" min="0">
                            </div>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold tbcs-blue mb-4 text-center">Horas por Actividad (Pegar desde Excel/CSV):</h3>
                    <div class="mb-6">
                        <label for="activityHoursCsv" class="block text-gray-700 text-sm font-bold mb-2">
                            Pegue aquí las actividades y sus horas. Formato: "Nombre de la Actividad, Horas"
                        </label>
                        <textarea id="activityHoursCsv" rows="15" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="Ejemplo:
Análisis de Requerimientos, 2
Diseño de Interfaces (UI/UX), 8
Diseño de Arquitectura, 8
Base de Datos de Clientes, 15
Historial y Comunicaciones, 12
Reportes de Clientes, 10
Pipeline de Ventas, 15
Cotizaciones y Propuestas, 10
Seguimiento y Alertas, 8
Planificación de Proyectos, 15
Control de Avance, 10
Gestión de Recursos, 10
Documentación y Archivos, 8
Facturación, 7
Control de Gastos, 9
Pruebas Unitarias, 4
Pruebas de Integración, 4
Pruebas de Usuario (UAT), 4
Configuración Producción, 8
Migración de Datos, 5
Capacitación de Usuarios, 2
Go-Live y Estabilización, 2"></textarea>
                        <p class="text-sm text-gray-500 mt-2">Asegúrese de que el "Nombre de la Actividad" coincida exactamente con el de la tabla para que las horas se apliquen correctamente. Las actividades no listadas aquí tendrán 0 horas.</p>
                    </div>

                    <h3 class="text-xl font-bold tbcs-blue mb-4 text-center">Notas Importantes y Condiciones:</h3>
                    <div class="mb-6">
                        <label for="notesConditionsInput" class="block text-gray-700 text-sm font-bold mb-2">
                            Escriba aquí las notas y condiciones importantes. Cada línea será un punto de la lista.
                        </label>
                        <textarea id="notesConditionsInput" rows="8" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
Tarifa por hora: $20 USD (tarifa promocional para el primer proyecto)
Tiempo estimado de desarrollo: 4 a 5 semanas hábiles
Soporte incluido: 30 días posteriores a la implementación para ajustes y correcciones menores
Hosting: No incluido. Se cotiza por separado de acuerdo con los requerimientos del proyecto
Garantía: 90 días sobre las funcionalidades desarrolladas
Forma de pago: 40% al inicio del proyecto y 60% al momento del go-live
Los precios se encuentran expresados en dólares americanos y no incluyen IVA. En caso de requerir factura, se deberá adicionar el impuesto correspondiente.
                        </textarea>
                    </div>

                    <div class="flex justify-center space-x-4 mt-6">
                        <button id="generateQuoteBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg focus:outline-none focus:shadow-outline transition duration-200">
                            Generar Cotización
                        </button>
                    </div>
                </section>
            </div>
        </div>

        <!-- Sección de Vista Previa de la Cotización (Contenido Dinámico) -->
        <section id="quotePreviewSection" class="hidden">
            <!-- Header de la Cotización -->
            <header class="flex flex-col md:flex-row justify-between items-center pb-8 border-b border-gray-200 mb-8">
                <div class="mb-4 md:mb-0">
                    <img src="uploaded:favicon_tbcs.png-d4832a93-306a-4214-8f86-b30ee113f8f5" alt="Logo TechBridge Consulting Systems" class="h-20 w-auto">
                </div>
                <div class="text-right">
                    <h1 class="text-4xl font-extrabold tbcs-blue mb-2">COTIZACIÓN</h1>
                    <p class="text-lg font-semibold text-gray-700">TechBridge Consulting Systems</p>
                    <p class="text-sm text-gray-500">contacto@tbcs.com.mx | +52 55 XXXX-XXXX</p>
                </div>
            </header>

            <!-- Información del Cliente y Cotización -->
            <section class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 text-gray-700">
                <div>
                    <h2 class="font-bold text-xl mb-2">Cliente:</h2>
                    <p><strong>Nombre del Cliente:</strong> <span id="previewClientName">Michelle Rodríguez</span></p>
                    <p><strong>Empresa:</strong> <span id="previewClientCompany">Grupo Mycor</span></p>
                    <p><strong>Email:</strong> <span id="previewClientEmail">rtmps@hotmail.com</span></p>
                    <p><strong>Celular:</strong> <span id="previewClientPhone">55 2900 5393</span></p>
                </div>
                <div class="md:text-right">
                    <h2 class="font-bold text-xl mb-2">Detalles de Cotización:</h2>
                    <p><strong>Número de Cotización:</strong> <span id="previewQuoteNumber">Q-TBCS-2025-001</span></p>
                    <p><strong>Fecha:</strong> <span id="previewQuoteDate">06 de Agosto de 2025</span></p>
                    <p><strong>Validez:</strong> <span id="previewQuoteValidity">30 días</span></p>
                </div>
            </section>

            <!-- Tabla de Módulos/Actividades -->
            <section class="mb-8 overflow-x-auto">
                <table class="quote-table">
                    <thead>
                        <tr>
                            <th style="width: 35%;">Módulo/Actividad</th>
                            <th style="width: 45%;">Descripción</th>
                            <th style="width: 10%;">Horas</th>
                            <th style="width: 10%;">Costo Parcial</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- 1. ANÁLISIS Y DISEÑO DEL SISTEMA -->
                        <tr>
                            <td colspan="4" class="module-header">1. ANÁLISIS Y DISEÑO DEL SISTEMA</td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Análisis de Requerimientos</td>
                            <td data-label="Descripción">Levantamiento detallado de necesidades, procesos actuales, definición de alcance</td>
                            <td data-label="Horas"><span id="display_horas_analisis_requerimientos">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_analisis_requerimientos">0</span></td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Diseño de Interfaces (UI/UX)</td>
                            <td data-label="Descripción">Mockups, wireframes y prototipo de interfaces de usuario</td>
                            <td data-label="Horas"><span id="display_horas_diseno_interfaces">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_diseno_interfaces">0</span></td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Diseño de Arquitectura</td>
                            <td data-label="Descripción">Diseño de base de datos, arquitectura del sistema y definición de tecnologías</td>
                            <td data-label="Horas"><span id="display_horas_diseno_arquitectura">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_diseno_arquitectura">0</span></td>
                        </tr>

                        <!-- 2. MÓDULO GESTIÓN DE CLIENTES -->
                        <tr>
                            <td colspan="4" class="module-header">2. MÓDULO GESTIÓN DE CLIENTES</td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Base de Datos de Clientes</td>
                            <td data-label="Descripción">CRUD completo, búsquedas avanzadas, categorización y segmentación</td>
                            <td data-label="Horas"><span id="display_horas_base_datos_clientes">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_base_datos_clientes">0</span></td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Historial y Comunicaciones</td>
                            <td data-label="Descripción">Registro de interacciones, notas, documentos y comunicaciones</td>
                            <td data-label="Horas"><span id="display_horas_historial_comunicaciones">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_historial_comunicaciones">0</span></td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Reportes de Clientes</td>
                            <td data-label="Descripción">Dashboards, análisis de satisfacción y reportes de actividad</td>
                            <td data-label="Horas"><span id="display_horas_reportes_clientes">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_reportes_clientes">0</span></td>
                        </tr>

                        <!-- 3. MÓDULO GESTIÓN DE OPORTUNIDADES -->
                        <tr>
                            <td colspan="4" class="module-header">3. MÓDULO GESTIÓN DE OPORTUNIDADES</td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Pipeline de Ventas</td>
                            <td data-label="Descripción">Entorno de ventas, etapas personalizables, seguimiento de oportunidades</td>
                            <td data-label="Horas"><span id="display_horas_pipeline_ventas">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_pipeline_ventas">0</span></td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Cotizaciones y Propuestas</td>
                            <td data-label="Descripción">Generación de cotizaciones, plantillas y seguimiento</td>
                            <td data-label="Horas"><span id="display_horas_cotizaciones_propuestas">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_cotizaciones_propuestas">0</span></td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Seguimiento y Alertas</td>
                            <td data-label="Descripción">Notificaciones automáticas y recordatorios.</td>
                            <td data-label="Horas"><span id="display_horas_seguimiento_alertas">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_seguimiento_alertas">0</span></td>
                        </tr>

                        <!-- 4. MÓDULO GESTIÓN DE PROYECTOS -->
                        <tr>
                            <td colspan="4" class="module-header">4. MÓDULO GESTIÓN DE PROYECTOS</td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Planificación de Proyectos</td>
                            <td data-label="Descripción">Creación de proyectos, cronogramas, hitos y asignación de recursos</td>
                            <td data-label="Horas"><span id="display_horas_planificacion_proyectos">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_planificacion_proyectos">0</span></td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Control de Avance</td>
                            <td data-label="Descripción">Seguimiento de progreso, control de tareas y gestión de cambios</td>
                            <td data-label="Horas"><span id="display_horas_control_avance">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_control_avance">0</span></td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Gestión de Recursos</td>
                            <td data-label="Descripción">Asignación de personal, maquinaria, materiales y subcontratistas</td>
                            <td data-label="Horas"><span id="display_horas_gestion_recursos">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_gestion_recursos">0</span></td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Documentación y Archivos</td>
                            <td data-label="Descripción">Gestión documental, planos, especificaciones y control de versiones</td>
                            <td data-label="Horas"><span id="display_horas_documentacion_archivos">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_documentacion_archivos">0</span></td>
                        </tr>

                        <!-- 5. MÓDULO GESTIÓN FINANCIERA BÁSICA -->
                        <tr>
                            <td colspan="4" class="module-header">5. MÓDULO GESTIÓN FINANCIERA BÁSICA</td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Facturación</td>
                            <td data-label="Descripción">Generación de correos para solicitar facturación, control de pagos y seguimiento de cuentas por cobrar</td>
                            <td data-label="Horas"><span id="display_horas_facturacion">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_facturacion">0</span></td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Control de Gastos</td>
                            <td data-label="Descripción">Registro de gastos por proyecto, categorización y aprobaciones</td>
                            <td data-label="Horas"><span id="display_horas_control_gastos">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_control_gastos">0</span></td>
                        </tr>

                        <!-- 6. PRUEBAS Y CONTROL DE CALIDAD -->
                        <tr>
                            <td colspan="4" class="module-header">6. PRUEBAS Y CONTROL DE CALIDAD</td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Pruebas Unitarias</td>
                            <td data-label="Descripción">Testing de componentes individuales y funciones críticas</td>
                            <td data-label="Horas"><span id="display_horas_pruebas_unitarias">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_pruebas_unitarias">0</span></td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Pruebas de Integración</td>
                            <td data-label="Descripción">Testing de flujos completos entre módulos</td>
                            <td data-label="Horas"><span id="display_horas_pruebas_integracion">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_pruebas_integracion">0</span></td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Pruebas de Usuario (UAT)</td>
                            <td data-label="Descripción">Testing con usuarios finales y corrección de observaciones</td>
                            <td data-label="Horas"><span id="display_horas_pruebas_usuario">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_pruebas_usuario">0</span></td>
                        </tr>

                        <!-- 7. IMPLEMENTACIÓN Y DESPLIEGUE -->
                        <tr>
                            <td colspan="4" class="module-header">7. IMPLEMENTACIÓN Y DESPLIEGUE</td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Configuración Producción</td>
                            <td data-label="Descripción">Setup de servidor de producción, seguridad y optimización</td>
                            <td data-label="Horas"><span id="display_horas_configuracion_produccion">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_configuracion_produccion">0</span></td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Migración de Datos</td>
                            <td data-label="Descripción">Importación de datos existentes y validación</td>
                            <td data-label="Horas"><span id="display_horas_migracion_datos">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_migracion_datos">0</span></td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Capacitación de Usuarios</td>
                            <td data-label="Descripción">Training del equipo, manuales y documentación</td>
                            <td data-label="Horas"><span id="display_horas_capacitacion_usuarios">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_capacitacion_usuarios">0</span></td>
                        </tr>
                        <tr>
                            <td data-label="Módulo/Actividad">Go-Live y Estabilización</td>
                            <td data-label="Descripción">Puesta en marcha, monitoreo inicial y ajustes menores</td>
                            <td data-label="Horas"><span id="display_horas_go_live">0</span></td>
                            <td data-label="Costo Parcial">$<span id="display_costo_go_live">0</span></td>
                        </tr>
                        <tr class="total-row">
                            <td colspan="2" data-label="TOTAL DESARROLLO">TOTAL DESARROLLO: <span id="totalHorasDisplay">0</span> Horas</td>
                            <td data-label="Costo Total" class="text-right" colspan="2">$<span id="totalCostoDisplay">0</span> USD</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Notas Importantes y Condiciones -->
            <section class="mb-8 text-gray-700">
                <h2 class="font-bold text-xl mb-4 tbcs-blue">Notas Importantes y Condiciones</h2>
                <ul class="list-disc list-inside space-y-2" id="previewNotesConditions">
                    <!-- Contenido generado por JavaScript -->
                </ul>
            </section>

            <!-- Botón de Imprimir Cotización -->
            <div class="flex justify-center space-x-4 mt-6 print-hidden">
                <button id="printQuoteBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg focus:outline-none focus:shadow-outline transition duration-200">
                    Imprimir Cotización
                </button>
            </div>

            <!-- Footer de la Cotización -->
            <footer class="text-center text-gray-500 text-sm pt-8 border-t border-gray-200">
                <p>Atentamente,</p>
                <p class="font-bold text-gray-700 mt-2">Ing. Jon</p>
                <p class="text-xs text-gray-500">Cel: xx-xx-xx-xx-xx</p>
                <p class="text-xs text-gray-500">Email: jon@tbcs.com.mx</p>
                <p class="mt-4">&copy; 2025 TechBridge Consulting Systems. Todos los derechos reservados.</p>
                <p>Cotización generada por TechBridge Consulting Systems.</p>
            </footer>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Referencias a los elementos del formulario
            const clientNameInput = document.getElementById('clientName');
            const clientCompanyInput = document.getElementById('clientCompany');
            const clientEmailInput = document.getElementById('clientEmail');
            const clientPhoneInput = document.getElementById('clientPhone');
            const quoteNumberInput = document.getElementById('quoteNumber');
            const quoteDateInput = document.getElementById('quoteDate');
            const quoteValidityInput = document.getElementById('quoteValidity');
            const hourlyRateInput = document.getElementById('hourlyRateInput');
            const activityHoursCsvInput = document.getElementById('activityHoursCsv');
            const notesConditionsInput = document.getElementById('notesConditionsInput');

            // Referencias a los elementos de visualización de la cotización
            const previewClientName = document.getElementById('previewClientName');
            const previewClientCompany = document.getElementById('previewClientCompany');
            const previewClientEmail = document.getElementById('previewClientEmail');
            const previewClientPhone = document.getElementById('previewClientPhone');
            const previewQuoteNumber = document.getElementById('previewQuoteNumber');
            const previewQuoteDate = document.getElementById('previewQuoteDate');
            const previewQuoteValidity = document.getElementById('previewQuoteValidity');
            const totalHorasDisplay = document.getElementById('totalHorasDisplay');
            const totalCostoDisplay = document.getElementById('totalCostoDisplay');
            const previewNotesConditionsUl = document.getElementById('previewNotesConditions');

            // Referencias a elementos del modal y secciones
            const openQuoteFormBtn = document.getElementById('openQuoteFormBtn');
            const quoteModal = document.getElementById('quoteModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const initialCallToAction = document.getElementById('initialCallToAction');
            const quotePreviewSection = document.getElementById('quotePreviewSection');

            // Mapeo de nombres de actividad a sus IDs de display en la tabla
            const activityDisplayMap = {
                "Análisis de Requerimientos": { hoursId: "display_horas_analisis_requerimientos", costId: "display_costo_analisis_requerimientos" },
                "Diseño de Interfaces (UI/UX)": { hoursId: "display_horas_diseno_interfaces", costId: "display_costo_diseno_interfaces" },
                "Diseño de Arquitectura": { hoursId: "display_horas_diseno_arquitectura", costId: "display_costo_diseno_arquitectura" },
                "Base de Datos de Clientes": { hoursId: "display_horas_base_datos_clientes", costId: "display_costo_base_datos_clientes" },
                "Historial y Comunicaciones": { hoursId: "display_horas_historial_comunicaciones", costId: "display_costo_historial_comunicaciones" },
                "Reportes de Clientes": { hoursId: "display_horas_reportes_clientes", costId: "display_costo_reportes_clientes" },
                "Pipeline de Ventas": { hoursId: "display_horas_pipeline_ventas", costId: "display_costo_pipeline_ventas" },
                "Cotizaciones y Propuestas": { hoursId: "display_horas_cotizaciones_propuestas", costId: "display_costo_cotizaciones_propuestas" },
                "Seguimiento y Alertas": { hoursId: "display_horas_seguimiento_alertas", costId: "display_costo_seguimiento_alertas" },
                "Planificación de Proyectos": { hoursId: "display_horas_planificacion_proyectos", costId: "display_costo_planificacion_proyectos" },
                "Control de Avance": { hoursId: "display_horas_control_avance", costId: "display_costo_control_avance" },
                "Gestión de Recursos": { hoursId: "display_horas_gestion_recursos", costId: "display_costo_gestion_recursos" },
                "Documentación y Archivos": { hoursId: "display_horas_documentacion_archivos", costId: "display_costo_documentacion_archivos" },
                "Facturación": { hoursId: "display_horas_facturacion", costId: "display_costo_facturacion" },
                "Control de Gastos": { hoursId: "display_horas_control_gastos", costId: "display_costo_control_gastos" },
                "Pruebas Unitarias": { hoursId: "display_horas_pruebas_unitarias", costId: "display_costo_pruebas_unitarias" },
                "Pruebas de Integración": { hoursId: "display_horas_pruebas_integracion", costId: "display_costo_pruebas_integracion" },
                "Pruebas de Usuario (UAT)": { hoursId: "display_horas_pruebas_usuario", costId: "display_costo_pruebas_usuario" },
                "Configuración Producción": { hoursId: "display_horas_configuracion_produccion", costId: "display_costo_configuracion_produccion" },
                "Migración de Datos": { hoursId: "display_horas_migracion_datos", costId: "display_costo_migracion_datos" },
                "Capacitación de Usuarios": { hoursId: "display_horas_capacitacion_usuarios", costId: "display_costo_capacitacion_usuarios" },
                "Go-Live y Estabilización": { hoursId: "display_horas_go_live", costId: "display_costo_go_live" }
            };

            // Botones
            const generateQuoteBtn = document.getElementById('generateQuoteBtn');
            const printQuoteBtn = document.getElementById('printQuoteBtn');

            // Función para formatear números a moneda (USD)
            const formatCurrency = (value) => {
                return value.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            };

            // Función para abrir el modal
            const openModal = () => {
                if (quoteModal) quoteModal.classList.remove('hidden');
                if (initialCallToAction) initialCallToAction.classList.add('hidden');
                // Set default date to today when opening the modal if it's empty
                if (!quoteDateInput.value) {
                    const today = new Date();
                    const year = today.getFullYear();
                    const month = String(today.getMonth() + 1).padStart(2, '0');
                    const day = String(today.getDate()).padStart(2, '0');
                    quoteDateInput.value = `${year}-${month}-${day}`;
                }
            };

            // Función para cerrar el modal
            const closeModal = () => {
                if (quoteModal) quoteModal.classList.add('hidden');
            };

            // Función principal para actualizar la vista previa de la cotización
            const updateQuotePreview = () => {
                // Actualizar información del cliente y cotización
                if (previewClientName) previewClientName.textContent = clientNameInput.value;
                if (previewClientCompany) previewClientCompany.textContent = clientCompanyInput.value;
                if (previewClientEmail) previewClientEmail.textContent = clientEmailInput.value;
                if (previewClientPhone) previewClientPhone.textContent = clientPhoneInput.value;
                if (previewQuoteNumber) previewQuoteNumber.textContent = quoteNumberInput.value;
                
                // Formatear la fecha
                const dateValue = quoteDateInput.value;
                if (previewQuoteDate) {
                    if (dateValue) {
                        const dateObj = new Date(dateValue + 'T12:00:00'); // Add T12:00:00 to avoid timezone issues
                        const options = { year: 'numeric', month: 'long', day: 'numeric' };
                        previewQuoteDate.textContent = dateObj.toLocaleDateString('es-ES', options);
                    } else {
                        previewQuoteDate.textContent = 'Fecha no especificada';
                    }
                }

                if (previewQuoteValidity) previewQuoteValidity.textContent = quoteValidityInput.value;
                
                const hourlyRate = parseFloat(hourlyRateInput.value) || 0;

                let totalHoras = 0;
                let totalCosto = 0;

                // Resetear todas las horas y costos a 0 antes de aplicar los nuevos valores
                for (const key in activityDisplayMap) {
                    const hoursSpan = document.getElementById(activityDisplayMap[key].hoursId);
                    const costSpan = document.getElementById(activityDisplayMap[key].costId);
                    if (hoursSpan) hoursSpan.textContent = 0;
                    if (costSpan) costSpan.textContent = formatCurrency(0);
                }

                // Procesar el textarea de actividades y horas
                const activityCsvData = activityHoursCsvInput.value;
                const lines = activityCsvData.split('\n');

                lines.forEach(line => {
                    const parts = line.split(',');
                    if (parts.length === 2) {
                        const activityName = parts[0].trim();
                        const hours = parseFloat(parts[1].trim()) || 0;

                        const mapping = activityDisplayMap[activityName];
                        if (mapping) {
                            const hoursSpan = document.getElementById(mapping.hoursId);
                            const costSpan = document.getElementById(mapping.costId);
                            
                            if (hoursSpan) {
                                hoursSpan.textContent = hours;
                                totalHoras += hours;
                            }
                            if (costSpan) {
                                costSpan.textContent = formatCurrency(hours * hourlyRate);
                            }
                        } else {
                            console.warn(`Actividad no reconocida: "${activityName}". Asegúrese de que el nombre coincida exactamente.`);
                        }
                    }
                });

                // Actualizar totales
                if (totalHorasDisplay) totalHorasDisplay.textContent = totalHoras;
                if (totalCostoDisplay) totalCostoDisplay.textContent = formatCurrency(totalHoras * hourlyRate);

                // Actualizar Notas Importantes y Condiciones
                const notesContent = notesConditionsInput.value;
                if (previewNotesConditionsUl) {
                    previewNotesConditionsUl.innerHTML = ''; // Limpiar elementos anteriores
                    notesContent.split('\n').forEach(line => {
                        const trimmedLine = line.trim();
                        if (trimmedLine) {
                            const li = document.createElement('li');
                            li.textContent = trimmedLine;
                            previewNotesConditionsUl.appendChild(li);
                        }
                    });
                }
            };

            // Event Listeners
            if (openQuoteFormBtn) openQuoteFormBtn.addEventListener('click', openModal);
            if (closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
            if (quoteModal) {
                // Close modal when clicking outside the content
                quoteModal.addEventListener('click', (e) => {
                    if (e.target === quoteModal) {
                        closeModal();
                    }
                });
            }

            // Event listeners para actualizar la vista previa en tiempo real dentro del modal
            clientNameInput.addEventListener('input', updateQuotePreview);
            clientCompanyInput.addEventListener('input', updateQuotePreview);
            clientEmailInput.addEventListener('input', updateQuotePreview);
            clientPhoneInput.addEventListener('input', updateQuotePreview);
            quoteNumberInput.addEventListener('input', updateQuotePreview);
            quoteDateInput.addEventListener('input', updateQuotePreview);
            quoteValidityInput.addEventListener('input', updateQuotePreview);
            hourlyRateInput.addEventListener('input', updateQuotePreview);
            activityHoursCsvInput.addEventListener('input', updateQuotePreview);
            notesConditionsInput.addEventListener('input', updateQuotePreview);

            // Asignar evento al botón de generar cotización
            if (generateQuoteBtn) {
                generateQuoteBtn.addEventListener('click', () => {
                    updateQuotePreview(); // Actualiza la vista previa
                    closeModal(); // Cierra el modal
                    if (quotePreviewSection) quotePreviewSection.classList.remove('hidden'); // Muestra la sección de la cotización
                });
            }

            // Asignar evento al botón de imprimir
            if (printQuoteBtn) {
                printQuoteBtn.addEventListener('click', () => {
                    window.print();
                });
            }

            // Ocultar la sección de vista previa al inicio
            if (quotePreviewSection) quotePreviewSection.classList.add('hidden');
        });
    </script>

</body>
</html>
